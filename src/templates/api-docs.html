<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <title>grlc</title>
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:400,700|Source+Code+Pro:300,600|Titillium+Web:400,600,700" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/swagger-ui/3.17.1/swagger-ui.css" >
    <link rel="icon" type="image/png" href="{{url_for('.static', filename='swagger-ui/dist/images/favicon-32x32.png')}}" sizes="32x32" />
    <link rel="icon" type="image/png" href="{{url_for('.static', filename='swagger-ui/dist/images/favicon-16x16.png')}}" sizes="16x16" />
    <style>
      html
      {
        box-sizing: border-box;
        overflow: -moz-scrollbars-vertical;
        overflow-y: scroll;
      }

      *,
      *:before,
      *:after
      {
        box-sizing: inherit;
      }

      body
      {
        margin:0;
        background: #fafafa;
      }
    </style>
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-80202120-1', 'auto');
      ga('send', 'pageview');

    </script>
  </head>

  <body>
    <div id='header'>
      <div class="swagger-ui">
        <div class="topbar">
          <a class="link" href="https://github.com/CLARIAH/grlc">
            <img height="50" width="50"  alt="grlc" src="{{url_for('.static', filename='grlc_logo_02.png')}}">
            <span>grlc</span>
          </a>
        </div>
      </div>
    </div>

    <div id="swagger-ui"></div>

    <div id="ohyeahdiv" class="swagger-ui-wrap" style="margin-top: 20px; display: none;">
      <p style="text-align:left;">
      <a href='#' id="ohyeah">Oh, yeah?</a>
      <span style="float:right;">&lt; <a id="prev-commit">Prev</a> | <a id="next-commit">Next</a> &gt;</span>
      </p>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/swagger-ui/3.17.1/swagger-ui-bundle.js"> </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/swagger-ui/3.17.1/swagger-ui-standalone-preset.js"> </script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.8.0/jquery-1.8.0.min.js" type='text/javascript'></script>
<!--    <script src="{{url_for('.static', filename='swagger-ui/dist/lib/jquery.slideto.min.js')}}" type='text/javascript'></script>
    <script src="{{url_for('.static', filename='swagger-ui/dist/lib/jquery.wiggle.min.js')}}" type='text/javascript'></script>-->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.ba-bbq/1.2.1/jquery.ba-bbq.min.js" type='text/javascript'></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/handlebars.js/2.0.0/handlebars.js" type='text/javascript'></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.9.1/underscore-min.js" type='text/javascript'></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/backbone.js/1.3.3/backbone-min.js" type='text/javascript'></script>

    <script crossorigin src="https://unpkg.com/react@16/umd/react.development.js"></script>

    <script>
    // Create the layout component
    class OperationsLayout extends React.Component {
      render() {
        const {
          getComponent
        } = this.props

        const Operations = getComponent("operations", true)
        const BaseLayout = getComponent("BaseLayout", true)

        // operationsJSX is the compiled version of JSX code:
        // (<div><BaseLayout /></div>)
        // Compiled using babeljs.io as suggested by https://reactjs.org/docs/react-without-jsx.html
        const operationsJSX = React.createElement(
          "div", null,
          React.createElement(BaseLayout, null)
        );
        return operationsJSX;
      }
    }

    // Create the plugin that provides our layout component
    const OperationsLayoutPlugin = () => {
      return {
        components: {
          OperationsLayout: OperationsLayout
        }
      }
    }

    window.onload = function() {
      url = "{{url_for('swagger_spec', user=user, repo=repo, sha=sha)}}";
      console.log('URL: ' + url);

      // Build a system
      const ui = SwaggerUIBundle({
        url: url,
        dom_id: '#swagger-ui',
        deepLinking: true,
        presets: [
          SwaggerUIBundle.presets.apis,
          SwaggerUIStandalonePreset
        ],
        plugins: [
          SwaggerUIBundle.plugins.DownloadUrl,
          OperationsLayoutPlugin
        ],
        layout: "OperationsLayout",
        validatorUrl: undefined, // required ??
        supportedSubmitMethods: ['get', 'post', 'put', 'delete', 'patch'],
        onComplete: function(swaggerApi, swaggerUi){
          if(typeof initOAuth == "function") {
            initOAuth({
              clientId: "your-client-id",
              clientSecret: "your-client-secret-if-required",
              realm: "your-realms",
              appName: "your-app-name",
              scopeSeparator: ","
            });
            get_prov(swaggerApi);
            set_commit_links(swaggerApi);
          }

          if(window.SwaggerTranslator) {
            window.SwaggerTranslator.translate();
          }

          $('pre code').each(function(i, e) {
            hljs.highlightBlock(e)
          });

          addApiKeyAuthorization();
        },
        onFailure: function(data) {
          log("Unable to Load SwaggerUI");
        },
        docExpansion: "list",
        apisSorter: "alpha",
        showRequestHeaders: true
      });

      function addApiKeyAuthorization(){
        var key = encodeURIComponent($('#input_apiKey')[0].value);
        if(key && key.trim() != "") {
            var apiKeyAuth = new SwaggerClient.ApiKeyAuthorization("api_key", key, "query");
            window.swaggerUi.api.clientAuthorizations.add("api_key", apiKeyAuth);
            log("added key " + key);
        }
      }

      $('#input_apiKey').change(addApiKeyAuthorization);

      // if you have an apiKey you would like to pre-populate on the page for demonstration purposes...
      /*
        var apiKey = "myApiKeyXXXX123456789";
        $('#input_apiKey').val(apiKey);
      */

      window.ui = ui

      function log() {
        if ('console' in window) {
          console.log.apply(console, arguments);
        }
      }
    };

    // new Clipboard('.btn');

    function set_commit_links(api) {
      console.log(api.swaggerObject['prev_commit']);
      console.log(api.swaggerObject['next_commit']);
      if (api.swaggerObject['prev_commit']) {
        if (window.location.href.includes('commit')) {
          $('#prev-commit').attr('href', api.swaggerObject['prev_commit']);
        } else {
          $('#prev-commit').attr('href', 'commit/' + api.swaggerObject['prev_commit']);
        }
      }
      if (api.swaggerObject['next_commit']) {
        if (window.location.href.includes('commit')) {
          $('#next-commit').attr('href', api.swaggerObject['next_commit']);
        } else {
          $('#next-commit').attr('href', 'commit/' + api.swaggerObject['next_commit']);
        }
      }
    }


    $('#ohyeah').click(function(e){
      var prov = $('#prov');
      if (prov.is(":visible")) {
        prov.hide();
      } else {
        prov.show();
      }
    });

    function get_prov(api) {
      $('#ohyeahdiv').show();
      data = api.swaggerObject['prov'].split("\n");
      var html = '<button class="btn" data-clipboard-target="#provdump">Copy</button><br><br><div id="provdump">';
      for (var i=0; i < data.length; i++) {
        html += '<div class="swagger-ui-wrap">' + data[i].replace("<", "&lt;").replace(">", "&gt;") + '</div>';
      }
      html += '</div>';
      $('#prov').html(html).linkify({target: "_blank"}).hide();
    }

  </script>
  </body>
</html>
